(function(){var Me={97412:(function(){(()=>{const Y=document.querySelectorAll("button.question--collapse");setTimeout(()=>{[...Y].forEach(H=>{H.classList.contains("question-error")&&H.click()})},100),$("button.collapse-all").on("click",()=>{$("[id$=field]").find("button.question--collapse[aria-expanded='true']").click()}),$("button.expand-all").on("click",()=>{$("[id$=field]").find("button.question--collapse[aria-expanded='false']").click()})})(window)})},he={};function ve(Y){var H=he[Y];if(H!==void 0)return H.exports;var j=he[Y]={exports:{}};return Me[Y](j,j.exports,ve),j.exports}(function(){"use strict";var Y=ve(97412);class H{constructor(e={}){this.listSelector=e.listSelector,this.minItems=e.minItems,this.hideOnMinItemsOrLessSelector=e.hideOnMinItemsOrLessSelector,this.run()}run(){const e=$(this.listSelector),n=e.find(this.hideOnMinItemsOrLessSelector);e.length<=this.minItems?n.hide():n.show()}}class j{constructor(e={}){this.wrapperSelector=e.wrapperSelector,this.selectSelector=e.selectSelector,this.listSelector=e.listSelector}run(){const e=$(this.listSelector),n=e.parents(this.wrapperSelector).find(this.selectSelector);n.find("option").slice(1).remove();for(let i=2;i<=e.length;i+=1)$(`<option value="${i}">${i}</option>`).appendTo(n)}}class Oe{constructor(e={}){this.$source=e.source,this.$select=e.select,this.sourceToParams=e.sourceToParams,this.run()}run(){this.$source.on("change",this._onSourceChange.bind(this)),this._onSourceChange()}_onSourceChange(){const e=this.$select,n=this.sourceToParams(this.$source),i=this.$source.data("url");$.getJSON(i,n,function(o){e.find("option:not([value=''])").remove();const a=e.data("selected");o.forEach(f=>{let w=$(`<option value="${f.id}">${f.body}</option>`).appendTo(e);f.id===a&&w.attr("selected",!0)}),a&&e.val(a)})}}class Pe{constructor(e={}){this.inputSelector=e.inputSelector,this.targetSelector=e.targetSelector,this.maxLength=e.maxLength,this.omission=e.omission,this.placeholder=e.placeholder,this._bindEvent(),this._run()}_run(){const e=$(this.inputSelector),n=$(this.targetSelector);let i=e.val()||this.placeholder;i.length>this.maxLength&&(i=i.substring(0,this.maxLength-this.omission.length)+this.omission),n.text(i)}_bindEvent(){$(this.inputSelector).on("change",this._run.bind(this))}}function He(t){return new Pe(t)}class Ue{constructor(e={}){this.listSelector=e.listSelector,this.hideOnFirstSelector=e.hideOnFirstSelector,this.hideOnLastSelector=e.hideOnLastSelector,this.run()}run(){const e=$(this.listSelector),n=this.hideOnFirstSelector,i=this.hideOnLastSelector;if(e.length===1){const o=e.first();o.find(n).hide(),o.find(i).hide()}else e.each((o,a)=>{a.id===e.first().attr("id")?($(a).find(n).hide(),$(a).find(i).show()):a.id===e.last().attr("id")?($(a).find(i).hide(),$(a).find(n).show()):($(a).find(i).show(),$(a).find(n).show())})}}class Re{constructor(e={}){this.listSelector=e.listSelector,this.labelSelector=e.labelSelector,this.onPositionComputed=e.onPositionComputed,this.run()}run(){$(this.listSelector).each((n,i)=>{const o=$(i).find(this.labelSelector),a=o.html();a.match(/#(\d+)/)?o.html(a.replace(/#(\d+)/,`#${n+1}`)):o.html(`${a} #${n+1}`),this.onPositionComputed&&this.onPositionComputed(i,n)})}}function g(t,e,n){if(n===void 0)return t&&t.h5s&&t.h5s.data&&t.h5s.data[e];t.h5s=t.h5s||{},t.h5s.data=t.h5s.data||{},t.h5s.data[e]=n}function Ye(t){t.h5s&&delete t.h5s.data}var F=(function(t,e){if(!(t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array))throw new Error("You must provide a nodeList/HTMLCollection/Array of elements to be filtered.");return typeof e!="string"?Array.from(t):Array.from(t).filter(function(n){return n.nodeType===1&&n.matches(e)})}),U=new Map,We=(function(){function t(){this._config=new Map,this._placeholder=void 0,this._data=new Map}return Object.defineProperty(t.prototype,"config",{get:function(){var e={};return this._config.forEach(function(n,i){e[i]=n}),e},set:function(e){if(typeof e!="object")throw new Error("You must provide a valid configuration object to the config setter.");var n=Object.assign({},e);this._config=new Map(Object.entries(n))},enumerable:!1,configurable:!0}),t.prototype.setConfig=function(e,n){if(!this._config.has(e))throw new Error("Trying to set invalid configuration item: "+e);this._config.set(e,n)},t.prototype.getConfig=function(e){if(!this._config.has(e))throw new Error("Invalid configuration item requested: "+e);return this._config.get(e)},Object.defineProperty(t.prototype,"placeholder",{get:function(){return this._placeholder},set:function(e){if(!(e instanceof HTMLElement)&&e!==null)throw new Error("A placeholder must be an html element or null.");this._placeholder=e},enumerable:!1,configurable:!0}),t.prototype.setData=function(e,n){if(typeof e!="string")throw new Error("The key must be a string.");this._data.set(e,n)},t.prototype.getData=function(e){if(typeof e!="string")throw new Error("The key must be a string.");return this._data.get(e)},t.prototype.deleteData=function(e){if(typeof e!="string")throw new Error("The key must be a string.");return this._data.delete(e)},t})(),v=(function(t){if(!(t instanceof HTMLElement))throw new Error("Please provide a sortable to the store function.");return U.has(t)||U.set(t,new We),U.get(t)});function x(t,e,n){if(t instanceof Array){for(var i=0;i<t.length;++i)x(t[i],e,n);return}t.addEventListener(e,n),v(t).setData("event"+e,n)}function m(t,e){if(t instanceof Array){for(var n=0;n<t.length;++n)m(t[n],e);return}t.removeEventListener(e,v(t).getData("event"+e)),v(t).deleteData("event"+e)}function A(t,e,n){if(t instanceof Array){for(var i=0;i<t.length;++i)A(t[i],e,n);return}t.setAttribute(e,n)}function W(t,e){if(t instanceof Array){for(var n=0;n<t.length;++n)W(t[n],e);return}t.removeAttribute(e)}var z=(function(t){if(!t.parentElement||t.getClientRects().length===0)throw new Error("target element must be part of the dom");var e=t.getClientRects()[0];return{left:e.left+window.pageXOffset,right:e.right+window.pageXOffset,top:e.top+window.pageYOffset,bottom:e.bottom+window.pageYOffset}}),Qe=(function(t,e){e===void 0&&(e=0);var n;return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];clearTimeout(n),n=setTimeout(function(){t.apply(void 0,i)},e)}}),Q=(function(t,e){if(!(t instanceof HTMLElement)||!(e instanceof NodeList||e instanceof HTMLCollection||e instanceof Array))throw new Error("You must provide an element and a list of elements.");return Array.from(e).indexOf(t)}),me=(function(t){if(!(t instanceof HTMLElement))throw new Error("Element is not a node element.");return t.parentNode!==null}),ge=function(t,e,n){if(!(t instanceof HTMLElement)||!(t.parentElement instanceof HTMLElement))throw new Error("target and element must be a node");t.parentElement.insertBefore(e,n==="before"?t:t.nextElementSibling)},ke=function(t,e){return ge(t,e,"before")},Se=function(t,e){return ge(t,e,"after")},je=(function(t,e,n){if(e===void 0&&(e=function(S,c){return S}),n===void 0&&(n=function(S){return S}),!(t instanceof HTMLElement)||!t.isSortable)throw new Error("You need to provide a sortableContainer to be serialized.");if(typeof e!="function"||typeof n!="function")throw new Error("You need to provide a valid serializer for items and the container.");var i=g(t,"opts"),o=i.items,a=F(t.children,o),f=a.map(function(S){return{parent:t,node:S,html:S.outerHTML,index:Q(S,a)}}),w={node:t,itemCount:f.length};return{container:n(w),items:f.map(function(S){return e(S,t)})}}),ze=(function(t,e,n){var i;if(n===void 0&&(n="sortable-placeholder"),!(t instanceof HTMLElement))throw new Error("You must provide a valid element as a sortable.");if(!(e instanceof HTMLElement)&&e!==void 0)throw new Error("You must provide a valid element as a placeholder or set ot to undefined.");return e===void 0&&(["UL","OL"].includes(t.tagName)?e=document.createElement("li"):["TABLE","TBODY"].includes(t.tagName)?(e=document.createElement("tr"),e.innerHTML='<td colspan="100"></td>'):e=document.createElement("div")),typeof n=="string"&&(i=e.classList).add.apply(i,n.split(" ")),e}),we=(function(t){if(!(t instanceof HTMLElement))throw new Error("You must provide a valid dom element");var e=window.getComputedStyle(t);return e.getPropertyValue("box-sizing")==="border-box"?parseInt(e.getPropertyValue("height"),10):["height","padding-top","padding-bottom"].map(function(n){var i=parseInt(e.getPropertyValue(n),10);return isNaN(i)?0:i}).reduce(function(n,i){return n+i})}),ye=(function(t){if(!(t instanceof HTMLElement))throw new Error("You must provide a valid dom element");var e=window.getComputedStyle(t);return["width","padding-left","padding-right"].map(function(n){var i=parseInt(e.getPropertyValue(n),10);return isNaN(i)?0:i}).reduce(function(n,i){return n+i})}),G=(function(t,e){if(!(t instanceof Array))throw new Error("You must provide a Array of HTMLElements to be filtered.");return typeof e!="string"?t:t.filter(function(n){return n.querySelector(e)instanceof HTMLElement||n.shadowRoot&&n.shadowRoot.querySelector(e)instanceof HTMLElement}).map(function(n){return n.querySelector(e)||n.shadowRoot&&n.shadowRoot.querySelector(e)})}),ie=(function(t){return t.composedPath&&t.composedPath()[0]||t.target}),Ve=function(t,e,n){return{element:t,posX:n.pageX-e.left,posY:n.pageY-e.top}},Xe=(function(t,e,n){if(!(t instanceof Event))throw new Error("setDragImage requires a DragEvent as the first argument.");if(!(e instanceof HTMLElement))throw new Error("setDragImage requires the dragged element as the second argument.");if(n||(n=Ve),t.dataTransfer&&t.dataTransfer.setDragImage){var i=z(e),o=n(e,i,t);if(!(o.element instanceof HTMLElement)||typeof o.posX!="number"||typeof o.posY!="number")throw new Error("The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].");t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setData("text/plain",ie(t).id),t.dataTransfer.setDragImage(o.element,o.posX,o.posY)}}),$e=(function(t,e){if(t.isSortable===!0){var n=v(t).getConfig("acceptFrom");if(n!==null&&n!==!1&&typeof n!="string")throw new Error('HTML5Sortable: Wrong argument, "acceptFrom" must be "null", "false", or a valid selector string.');if(n!==null)return n!==!1&&n.split(",").filter(function(i){return i.length>0&&e.matches(i)}).length>0;if(t===e)return!0;if(v(t).getConfig("connectWith")!==void 0&&v(t).getConfig("connectWith")!==null)return v(t).getConfig("connectWith")===v(e).getConfig("connectWith")}return!1}),Ne={items:null,connectWith:null,disableIEFix:null,acceptFrom:null,copy:!1,placeholder:null,placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",hoverClass:!1,dropTargetContainerClass:!1,debounce:0,throttleTime:100,maxItems:0,itemSerializer:void 0,containerSerializer:void 0,customDragImage:null,orientation:"vertical"};function Je(t,e){var n=this;if(e===void 0&&(e=250),typeof t!="function")throw new Error("You must provide a function as the first argument for throttle.");if(typeof e!="number")throw new Error("You must provide a number as the second argument for throttle.");var i=null;return function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];var f=Date.now();(i===null||f-i>=e)&&(i=f,t.apply(n,o))}}var Ge=(function(t,e){if(typeof v(t).getConfig("hoverClass")=="string"){var n=v(t).getConfig("hoverClass").split(" ");e===!0?(x(t,"mousemove",Je(function(i){i.buttons===0&&F(t.children,v(t).getConfig("items")).forEach(function(o){var a,f;o!==i.target?(a=o.classList).remove.apply(a,n):(f=o.classList).add.apply(f,n)})},v(t).getConfig("throttleTime"))),x(t,"mouseleave",function(){F(t.children,v(t).getConfig("items")).forEach(function(i){var o;(o=i.classList).remove.apply(o,n)})})):(m(t,"mousemove"),m(t,"mouseleave"))}}),p,V,X,E,R,M,re,N,oe,ae=function(t){m(t,"dragstart"),m(t,"dragend"),m(t,"dragover"),m(t,"dragenter"),m(t,"drop"),m(t,"mouseenter"),m(t,"mouseleave")},se=function(t,e){t&&m(t,"dragleave"),e&&e!==t&&m(e,"dragleave")},Ze=function(t,e){var n=t;return v(e).getConfig("copy")===!0&&(n=t.cloneNode(!0),A(n,"aria-copied","true"),t.parentElement.appendChild(n),n.style.display="none",n.oldDisplay=t.style.display),n},Fe=function(t){Ye(t),W(t,"aria-dropeffect")},Te=function(t){W(t,"aria-grabbed"),W(t,"aria-copied"),W(t,"draggable"),W(t,"role")};function de(t,e){if(e.composedPath)return e.composedPath().find(function(n){return n.isSortable});for(;t.isSortable!==!0;)t=t.parentElement;return t}function _e(t,e){var n=g(t,"opts"),i=F(t.children,n.items),o=i.filter(function(a){return a.contains(e)||a.shadowRoot&&a.shadowRoot.contains(e)});return o.length>0?o[0]:e}var Ke=function(t){var e=g(t,"opts")||{},n=F(t.children,e.items),i=G(n,e.handle);m(t,"dragover"),m(t,"dragenter"),m(t,"dragstart"),m(t,"dragend"),m(t,"drop"),Fe(t),m(i,"mousedown"),ae(n),Te(n),se(E,N),t.isSortable=!1},be=function(t){var e=g(t,"opts"),n=F(t.children,e.items),i=G(n,e.handle);if(A(t,"aria-dropeffect","move"),g(t,"_disabled","false"),A(i,"draggable","true"),e.disableIEFix===!1){var o=(document||window.document).createElement("span");typeof o.dragDrop=="function"&&x(i,"mousedown",function(){if(n.indexOf(this)!==-1)this.dragDrop();else{for(var a=this.parentElement;n.indexOf(a)===-1;)a=a.parentElement;a.dragDrop()}})}},et=function(t){var e=g(t,"opts"),n=F(t.children,e.items),i=G(n,e.handle);A(t,"aria-dropeffect","none"),g(t,"_disabled","true"),A(i,"draggable","false"),m(i,"mousedown")},tt=function(t){var e=g(t,"opts"),n=F(t.children,e.items),i=G(n,e.handle);g(t,"_disabled","false"),ae(n),se(E,N),m(i,"mousedown"),m(t,"dragover"),m(t,"dragenter"),m(t,"drop")};function k(t,e){var n=String(e);return e=e||{},typeof t=="string"&&(t=document.querySelectorAll(t)),t instanceof HTMLElement&&(t=[t]),t=Array.prototype.slice.call(t),/serialize/.test(n)?t.map(function(i){var o=g(i,"opts");return je(i,o.itemSerializer,o.containerSerializer)}):(t.forEach(function(i){if(/enable|disable|destroy/.test(n))return k[n](i);["connectWith","disableIEFix"].forEach(function(c){Object.prototype.hasOwnProperty.call(e,c)&&e[c]!==null&&console.warn('HTML5Sortable: You are using the deprecated configuration "'+c+'". This will be removed in an upcoming version, make sure to migrate to the new options when updating.')}),e=Object.assign({},Ne,v(i).config,e),v(i).config=e,g(i,"opts",e),i.isSortable=!0,tt(i);var o=F(i.children,e.items),a;if(e.placeholder!==null&&e.placeholder!==void 0){var f=document.createElement(i.tagName);e.placeholder instanceof HTMLElement?f.appendChild(e.placeholder):f.innerHTML=e.placeholder,a=f.children[0]}v(i).placeholder=ze(i,a,e.placeholderClass),g(i,"items",e.items),e.acceptFrom?g(i,"acceptFrom",e.acceptFrom):e.connectWith&&g(i,"connectWith",e.connectWith),be(i),A(o,"role","option"),A(o,"aria-grabbed","false"),Ge(i,!0),x(i,"dragstart",function(c){var s=ie(c);if(s.isSortable!==!0&&(c.stopImmediatePropagation(),!(e.handle&&!s.matches(e.handle)||s.getAttribute("draggable")==="false"))){var d=de(s,c),h=_e(d,s);re=F(d.children,e.items),R=re.indexOf(h),M=Q(h,d.children),E=d,Xe(c,h,e.customDragImage),V=we(h),X=ye(h),h.classList.add(e.draggingClass),p=Ze(h,d),A(p,"aria-grabbed","true"),d.dispatchEvent(new CustomEvent("sortstart",{detail:{origin:{elementIndex:M,index:R,container:E},item:p,originalTarget:s}}))}}),x(i,"dragenter",function(c){var s=ie(c),d=de(s,c);d&&d!==N&&(oe=F(d.children,g(d,"items")).filter(function(h){return h!==v(i).placeholder}),e.dropTargetContainerClass&&d.classList.add(e.dropTargetContainerClass),d.dispatchEvent(new CustomEvent("sortenter",{detail:{origin:{elementIndex:M,index:R,container:E},destination:{container:d,itemsBeforeUpdate:oe},item:p,originalTarget:s}})),x(d,"dragleave",function(h){var y=h.relatedTarget||h.fromElement;h.currentTarget.contains(y)||(e.dropTargetContainerClass&&d.classList.remove(e.dropTargetContainerClass),d.dispatchEvent(new CustomEvent("sortleave",{detail:{origin:{elementIndex:M,index:R,container:d},item:p,originalTarget:s}})))})),N=d}),x(i,"dragend",function(c){if(p){p.classList.remove(e.draggingClass),A(p,"aria-grabbed","false"),p.getAttribute("aria-copied")==="true"&&g(p,"dropped")!=="true"&&p.remove(),p.style.display=p.oldDisplay,delete p.oldDisplay;var s=Array.from(U.values()).map(function(d){return d.placeholder}).filter(function(d){return d instanceof HTMLElement}).filter(me)[0];s&&s.remove(),i.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:M,index:R,container:E},item:p}})),N=null,p=null,V=null,X=null}}),x(i,"drop",function(c){if($e(i,p.parentElement)){c.preventDefault(),c.stopPropagation(),g(p,"dropped","true");var s=Array.from(U.values()).map(function(T){return T.placeholder}).filter(function(T){return T instanceof HTMLElement}).filter(me)[0];Se(s,p),s.remove(),i.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:M,index:R,container:E},item:p}}));var d=v(i).placeholder,h=F(E.children,e.items).filter(function(T){return T!==d}),y=this.isSortable===!0?this:this.parentElement,q=F(y.children,g(y,"items")).filter(function(T){return T!==d}),O=Q(p,Array.from(p.parentElement.children).filter(function(T){return T!==d})),I=Q(p,q);e.dropTargetContainerClass&&y.classList.remove(e.dropTargetContainerClass),(M!==O||E!==y)&&i.dispatchEvent(new CustomEvent("sortupdate",{detail:{origin:{elementIndex:M,index:R,container:E,itemsBeforeUpdate:re,items:h},destination:{index:I,elementIndex:O,container:y,itemsBeforeUpdate:oe,items:q},item:p}}))}});var w=Qe(function(c,s,d,h){if(p)if(e.forcePlaceholderSize&&(v(c).placeholder.style.height=V+"px",v(c).placeholder.style.width=X+"px"),Array.from(c.children).indexOf(s)>-1){var y=we(s),q=ye(s),O=Q(v(c).placeholder,s.parentElement.children),I=Q(s,s.parentElement.children);if(y>V||q>X){var T=y-V,ce=q-X,K=z(s).top,ee=z(s).left;if(O<I&&(e.orientation==="vertical"&&h<K||e.orientation==="horizontal"&&d<ee)||O>I&&(e.orientation==="vertical"&&h>K+y-T||e.orientation==="horizontal"&&d>ee+q-ce))return}p.oldDisplay===void 0&&(p.oldDisplay=p.style.display),p.style.display!=="none"&&(p.style.display="none");var J=!1;try{var B=z(s).top+s.offsetHeight/2,P=z(s).left+s.offsetWidth/2;J=e.orientation==="vertical"&&h>=B||e.orientation==="horizontal"&&d>=P}catch(_){J=O<I}J?Se(s,v(c).placeholder):ke(s,v(c).placeholder),Array.from(U.values()).filter(function(_){return _.placeholder!==void 0}).forEach(function(_){_.placeholder!==v(c).placeholder&&_.placeholder.remove()})}else{var te=Array.from(U.values()).filter(function(_){return _.placeholder!==void 0}).map(function(_){return _.placeholder});te.indexOf(s)===-1&&c===s&&!F(s.children,e.items).length&&(te.forEach(function(_){return _.remove()}),s.appendChild(v(c).placeholder))}},e.debounce),S=function(c){var s=c.target,d=s.isSortable===!0?s:de(s,c);if(s=_e(d,s),!(!p||!$e(d,p.parentElement)||g(d,"_disabled")==="true")){var h=g(d,"opts");parseInt(h.maxItems)&&F(d.children,g(d,"items")).length>=parseInt(h.maxItems)&&p.parentElement!==d||(c.preventDefault(),c.stopPropagation(),c.dataTransfer.dropEffect=v(d).getConfig("copy")===!0?"copy":"move",w(d,s,c.pageX,c.pageY))}};x(o.concat(i),"dragover",S),x(o.concat(i),"dragenter",S)}),t)}k.destroy=function(t){Ke(t)},k.enable=function(t){be(t)},k.disable=function(t){et(t)},k.__testing={data:g,removeItemEvents:ae,removeItemData:Te,removeSortableData:Fe,removeContainerEvents:se};var nt=k;class it{constructor(e,n){$(e).length>0&&nt(e,n)[0].addEventListener("sortupdate",i=>{const o=$(i.target).children();n.onSortUpdate&&n.onSortUpdate(o)})}}function rt(t,e){return new it(t,e)}class ot{constructor(e={}){this.wrapperSelector=e.wrapperSelector,this.containerSelector=e.containerSelector,this.fieldSelector=e.fieldSelector,this.addFieldButtonSelector=e.addFieldButtonSelector,this.addSeparatorButtonSelector=e.addSeparatorButtonSelector,this.addTitleAndDescriptionButtonSelector=e.addTitleAndDescriptionButtonSelector,this.fieldTemplateSelector=e.fieldTemplateSelector,this.separatorTemplateSelector=e.separatorTemplateSelector,this.TitleAndDescriptionTemplateSelector=e.TitleAndDescriptionTemplateSelector,this.removeFieldButtonSelector=e.removeFieldButtonSelector,this.moveUpFieldButtonSelector=e.moveUpFieldButtonSelector,this.moveDownFieldButtonSelector=e.moveDownFieldButtonSelector,this.onAddField=e.onAddField,this.onRemoveField=e.onRemoveField,this.onMoveUpField=e.onMoveUpField,this.onMoveDownField=e.onMoveDownField,this.placeholderId=e.placeholderId,this.elementCounter=0,this._enableInterpolation(),this._activateFields(),this._bindEvents()}_enableInterpolation(){$.fn.replaceAttribute=function(e,n,i){return $(this).find(`[${e}*=${n}]`).addBack(`[${e}*=${n}]`).each((o,a)=>{$(a).attr(e,$(a).attr(e).replace(n,i))}),this},$.fn.template=function(e,n){const i=$(this).find("template, .decidim-template");i.length>0&&i.html((a,f)=>$(f).template(e,n)[0].outerHTML);const o=$(this).find("[data-template]");return o.length>0&&o.each((a,f)=>{const w=$(f),S=$(w.data("template")),c=$(S[0].outerHTML),s=`${S.attr("id")}-${n}`,d=`#${s}`;c.attr("id",s),w.attr("data-template",d).data("template",d),S.after(c),c.html((h,y)=>$(y).template(e,n)[0].outerHTML)}),$(this).replaceAttribute("id",e,n),$(this).replaceAttribute("name",e,n),$(this).replaceAttribute("data-tabs-content",e,n),$(this).replaceAttribute("for",e,n),$(this).replaceAttribute("tabs_id",e,n),$(this).replaceAttribute("href",e,n),$(this).replaceAttribute("value",e,n),this}}_bindEvents(){$(this.wrapperSelector).on("click",this.addFieldButtonSelector,e=>this._bindSafeEvent(e,()=>this._addField(this.fieldTemplateSelector))),this.addSeparatorButtonSelector&&$(this.wrapperSelector).on("click",this.addSeparatorButtonSelector,e=>this._bindSafeEvent(e,()=>this._addField(this.separatorTemplateSelector))),this.addTitleAndDescriptionButtonSelector&&$(this.wrapperSelector).on("click",this.addTitleAndDescriptionButtonSelector,e=>this._bindSafeEvent(e,()=>this._addField(this.TitleAndDescriptionTemplateSelector))),$(this.wrapperSelector).on("click",this.removeFieldButtonSelector,e=>this._bindSafeEvent(e,n=>this._removeField(n))),this.moveUpFieldButtonSelector&&$(this.wrapperSelector).on("click",this.moveUpFieldButtonSelector,e=>this._bindSafeEvent(e,n=>this._moveUpField(n))),this.moveDownFieldButtonSelector&&$(this.wrapperSelector).on("click",this.moveDownFieldButtonSelector,e=>this._bindSafeEvent(e,n=>this._moveDownField(n)))}_bindSafeEvent(e,n){e.preventDefault(),e.stopPropagation();try{return n(e.target)}catch(i){return console.error(i),i}}_addField(e=".decidim-template"){const n=$(this.wrapperSelector),i=n.find(this.containerSelector),o=n.data("template");let a=null;o&&(a=$(o)),(a===null||a.length<1)&&(a=n.children(`template, ${e}`));const f=$(a.html()).template(this.placeholderId,this._getUID());f.find("ul.tabs").attr("data-tabs",!0);const w=i.find(this.fieldSelector).last();w.length>0?w.after(f):f.appendTo(i),window.initFoundation(f),this.onAddField&&this.onAddField(f)}_removeField(e){const i=$(e).parents(this.fieldSelector);if(i.find("input").filter((a,f)=>f.name.match(/id/)).length>0){const a=i.find("input").filter((f,w)=>w.name.match(/delete/));a.length>0&&$(a[0]).val(!0),i.addClass("hidden"),i.hide()}else i.remove();this.onRemoveField&&this.onRemoveField(i)}_moveUpField(e){const i=$(e).parents(this.fieldSelector);i.prev().before(i),this.onMoveUpField&&this.onMoveUpField(i)}_moveDownField(e){const i=$(e).parents(this.fieldSelector);i.next().after(i),this.onMoveDownField&&this.onMoveDownField(i)}_activateFields(){const n=$(this.wrapperSelector).find(this.containerSelector);n.append(n.find("script")),$(this.fieldSelector).each((i,o)=>{$(o).template(this.placeholderId,this._getUID()),$(o).find("ul.tabs").attr("data-tabs",!0)})}_getUID(){return this.elementCounter+=1,new Date().getTime()+this.elementCounter}}function Z(t){return new ot(t)}class at{constructor(e={}){this.controllerField=e.controllerField,this.wrapperSelector=e.wrapperSelector,this.dependentFieldsSelector=e.dependentFieldsSelector,this.dependentInputSelector=e.dependentInputSelector,this.enablingCondition=e.enablingCondition,this._bindEvent(),this._run()}_run(){const e=this.controllerField,n=e.parents(this.wrapperSelector).find(this.dependentFieldsSelector),i=n.find(this.dependentInputSelector);this.enablingCondition(e)?(i.prop("disabled",!1),n.show()):(i.prop("disabled",!0),n.hide())}_bindEvent(){this.controllerField.on("change",()=>{this._run()})}}function le(t){return new at(t)}function st(t){t.forEach(e=>{e.addEventListener("change",()=>{let n=e.value,i=e.parentElement.parentElement.nextElementSibling;i.querySelector(".is-active").ariaHidden="true",i.querySelector(".is-active").classList.remove("is-active"),i.querySelector(n).ariaHidden="false",i.querySelector(n).classList.add("is-active")})})}function dt(){const t=".questionnaire-questions",e=".questionnaire-question",n="select[name$=\\[question_type\\]]",i=".questionnaire-question-answer-option",o=".questionnaire-question-answer-options",a=".remove-answer-option",f=".questionnaire-question-matrix-row",w=".questionnaire-question-matrix-rows",S=".remove-matrix-row",c=".add-matrix-row",s=".questionnaire-question-max-choices",d=".questionnaire-question-display-condition",h=".questionnaire-question-display-conditions",y=".remove-display-condition",q="select[name$=\\[decidim_condition_question_id\\]]",O="select[name$=\\[decidim_answer_option_id\\]]",I="select[name$=\\[condition_type\\]]",T="input[name$=\\[deleted\\]]",ce=".questionnaire-question-display-condition-value",K=".questionnaire-question-display-condition-answer-option",ee=".add-display-condition",J=()=>{$(e).each((r,l)=>{const u=$(l);r?(u.find(h).find(T).val("false"),u.find(h).show()):(u.find(h).find(T).val("true"),u.find(h).hide())})},B=new Ue({listSelector:".questionnaire-question:not(.hidden)",hideOnFirstSelector:".move-up-question",hideOnLastSelector:".move-down-question"}),P=new Re({listSelector:".questionnaire-question:not(.hidden)",labelSelector:".card-title span:first",onPositionComputed:(r,l)=>{$(r).find("input[name$=\\[position\\]]:not([name*=\\[matrix_rows\\]])").val(l),B.run(),J()}}),te=["single_option","multiple_option","sorting","matrix_single","matrix_multiple"],_=["matrix_single","matrix_multiple"],ct=r=>new j({wrapperSelector:e,selectSelector:`${s} select`,listSelector:`#${r} ${o} .questionnaire-question-answer-option:not(.hidden)`}),ut=r=>new H({wrapperSelector:e,listSelector:`#${r} ${o} .questionnaire-question-answer-option:not(.hidden)`,minItems:2,hideOnMinItemsOrLessSelector:a}),pt=r=>new Oe({source:r.find(q),select:r.find(O),sourceToParams:l=>({id:l.val()})}),xe=()=>{rt(".questionnaire-questions-list:not(.published)",{handle:".question-divider",placeholder:'<div style="border-style: dashed; border-color: #000"></div>',forcePlaceholderSize:!0,onSortUpdate:()=>{P.run(),B.run()}})},ft=r=>{const l=`#${r} .question-title-statement`,u=$(l).data("locale"),C=$(l).data("max-length"),b=$(l).data("omission"),L=$(l).data("placeholder");return He({inputSelector:`#${r} input[name$=\\[body_${u}\\]]`,targetSelector:l,maxLength:C,omission:b,placeholder:L})},ht=r=>{const l=r.find(".collapsible");if(l.length>0){const C=`${l.attr("id").replace("-question-card","")}-question-card`;r.find(".question--collapse").attr("data-controls",C)}},vt=r=>{const l=ut(r),u=ct(r);return Z({placeholderId:"questionnaire-question-answer-option-id",wrapperSelector:`#${r} ${o}`,containerSelector:".questionnaire-question-answer-options-list",fieldSelector:i,addFieldButtonSelector:".add-answer-option",fieldTemplateSelector:".decidim-answer-option-template",removeFieldButtonSelector:a,onAddField:()=>{l.run(),u.run()},onRemoveField:()=>{l.run(),u.run()}})},ue={},mt=r=>Z({placeholderId:"questionnaire-question-matrix-row-id",wrapperSelector:`#${r} ${w}`,containerSelector:".questionnaire-question-matrix-rows-list",fieldSelector:f,addFieldButtonSelector:c,fieldTemplateSelector:".decidim-matrix-row-template",removeFieldButtonSelector:S,onAddField:()=>{},onRemoveField:()=>{}}),pe={},ne=r=>te.indexOf(r)>=0,qe=r=>_.indexOf(r)>=0,Ce=r=>{const l=r.options[r.selectedIndex];return $(l).data("type")},Le=r=>{const l=r.find(q),u=Ce(l[0]),C=ne(u);let b=["answered","not_answered"];C&&(b.push("equal"),b.push("not_equal")),b.push("match");const L=r.find(I);L.find("option").each((D,wt)=>{const fe=$(wt),Be=fe.val();Be&&(fe.show(),b.indexOf(Be)<0&&fe.hide())}),b.indexOf(L.val())<0&&L.val(b[0]),L.trigger("change")},De=r=>{const l=r.find(I).val(),u=r.find(ce),C=r.find(K),b=r.find(q),L=Ce(b[0]),D=ne(L);l==="match"?u.show():u.hide(),D&&(l==="not_equal"||l==="equal")?C.show():C.hide()},Ae=r=>{pt(r).run(),r.find(q).on("change",()=>{Le(r)}),r.find(I).on("change",()=>{De(r)}),De(r),Le(r)},gt=r=>Z({placeholderId:"questionnaire-question-display-condition-id",wrapperSelector:`#${r} ${h}`,containerSelector:".questionnaire-question-display-conditions-list",fieldSelector:d,addFieldButtonSelector:ee,removeFieldButtonSelector:y,onAddField:l=>{Ae(l)},onRemoveField:()=>{}}),Ee={},Ie=r=>{const l=r.attr("id"),u=r.find(n);ht(r),ft(l),le({controllerField:u,wrapperSelector:e,dependentFieldsSelector:o,dependentInputSelector:`${i} input`,enablingCondition:D=>ne(D.val())}),le({controllerField:u,wrapperSelector:e,dependentFieldsSelector:s,dependentInputSelector:"select",enablingCondition:D=>D.val()==="multiple_option"||D.val()==="matrix_multiple"}),le({controllerField:u,wrapperSelector:e,dependentFieldsSelector:w,dependentInputSelector:`${f} input`,enablingCondition:D=>qe(D.val())}),ue[l]=vt(l),pe[l]=mt(l),Ee[l]=gt(l);const C=ue[l],b=pe[l],L=()=>{ne(u.val())&&u.parents(e).find(i).length===0&&(C._addField(),C._addField()),qe(u.val())&&u.parents(e).find(f).length===0&&(b._addField(),b._addField())};u.on("change",L),L()},St=r=>{r.find("input[name$=\\[deleted\\]]").val()==="true"&&(r.addClass("hidden"),r.hide())};Z({placeholderId:"questionnaire-question-id",wrapperSelector:t,containerSelector:".questionnaire-questions-list",fieldSelector:e,addFieldButtonSelector:".add-question",addSeparatorButtonSelector:".add-separator",addTitleAndDescriptionButtonSelector:".add-title-and-description",fieldTemplateSelector:".decidim-question-template",separatorTemplateSelector:".decidim-separator-template",TitleAndDescriptionTemplateSelector:".decidim-title-and-description-template",removeFieldButtonSelector:".remove-question",moveUpFieldButtonSelector:".move-up-question",moveDownFieldButtonSelector:".move-down-question",onAddField:r=>{Ie(r),xe(),P.run(),B.run(),st(r.find("select.language-change").toArray()),document.dispatchEvent(new CustomEvent("ajax:loaded",{detail:r[0]}))},onRemoveField:r=>{P.run(),B.run(),r.find(a).each((l,u)=>{ue[r.attr("id")]._removeField(u)}),r.find(S).each((l,u)=>{pe[r.attr("id")]._removeField(u)}),r.find(y).each((l,u)=>{Ee[r.attr("id")]._removeField(u)})},onMoveUpField:()=>{P.run(),B.run()},onMoveDownField:()=>{P.run(),B.run()}}),xe(),$(e).each((r,l)=>{const u=$(l);St(u),Ie(u)}),$(d).each((r,l)=>{const u=$(l);Ae(u)}),P.run(),B.run()}function lt(t){t.addEventListener("click",()=>{const e=t.dataset.publishQuestionAnswerAction,n=t.dataset.publishQuestionAnswerQuestionUrl,i=t.closest(".toggle__switch-toggle").querySelector(".toggle__switch-trigger-text"),o=i.querySelector(".label.success"),a=i.querySelector(".label.alert");switch(e){case"publish":Rails.ajax({url:n,type:"PUT",success:function(){t.setAttribute("data-publish-question-answer-action","unpublish"),o.classList.remove("hidden"),a.classList.add("hidden")}});break;case"unpublish":Rails.ajax({url:n,type:"DELETE",success:function(){t.setAttribute("data-publish-question-answer-action","publish"),a.classList.remove("hidden"),o.classList.add("hidden")}});break;default:console.log(`Publish questions answers: Unknown action ${e}`)}})}window.Decidim.createEditableForm=dt,document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("[data-publish-question-answer-action]").forEach(t=>lt(t))})})()})();

//# sourceMappingURL=decidim_forms_admin-b09e22e745f6af70f83f.js.map