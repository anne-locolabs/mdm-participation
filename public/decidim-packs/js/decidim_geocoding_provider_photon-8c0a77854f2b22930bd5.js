(function(){var tt={55657:(function(S){var w,E;w=this,E=function(){"use strict";function F(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable}))),n.push.apply(n,i)}return n}function _(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?F(Object(n),!0).forEach((function(i){I(t,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):F(Object(n)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))}))}return t}function x(t){return x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(t)}function I(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t){return(function(e){if(Array.isArray(e))return y(e)})(t)||(function(e){if(typeof Symbol!="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)})(t)||c(t)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function c(t,e){if(t){if(typeof t=="string")return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set"?Array.from(t):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}function y(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var d=function(t){return typeof t=="string"?document.querySelector(t):t()},p=function(t,e){var n=typeof t=="string"?document.createElement(t):t;for(var i in e){var s=e[i];if(i==="inside")s.append(n);else if(i==="dest")d(s[0]).insertAdjacentElement(s[1],n);else if(i==="around"){var a=s;a.parentNode.insertBefore(n,a),n.append(a),a.getAttribute("autofocus")!=null&&a.focus()}else i in n?n[i]=s:n.setAttribute(i,s)}return n},k=function(t,e){return t=String(t).toLowerCase(),e?t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").normalize("NFC"):t},L=function(t,e){return p("mark",_({innerHTML:t},typeof e=="string"&&{class:e})).outerHTML},g=function(t,e){e.input.dispatchEvent(new CustomEvent(t,{bubbles:!0,detail:e.feedback,cancelable:!0}))},O=function(t,e,n){var i=n||{},s=i.mode,a=i.diacritics,l=i.highlight,m=k(e,a);if(e=String(e),t=k(t,a),s==="loose"){var f=(t=t.replace(/ /g,"")).length,o=0,h=Array.from(e).map((function(b,v){return o<f&&m[v]===t[o]&&(b=l?L(b,l):b,o++),b})).join("");if(o===f)return h}else{var u=m.indexOf(t);if(~u)return t=e.substring(u,u+t.length),u=l?e.replace(t,L(t,l)):e}},M=function(t,e){return new Promise((function(n,i){var s;return(s=t.data).cache&&s.store?n():new Promise((function(a,l){return typeof s.src=="function"?s.src(e).then(a,l):a(s.src)})).then((function(a){try{return t.feedback=s.store=a,g("response",t),n()}catch(l){return i(l)}}),i)}))},J=function(t,e){var n=e.data,i=e.searchEngine,s=[];n.store.forEach((function(l,m){var f=function(u){var b=u?l[u]:l,v=typeof i=="function"?i(t,b):O(t,b,{mode:i,diacritics:e.diacritics,highlight:e.resultItem.highlight});if(v){var P={match:v,value:l};u&&(P.key=u),s.push(P)}};if(n.keys){var o,h=(function(u,b){var v=typeof Symbol!="undefined"&&u[Symbol.iterator]||u["@@iterator"];if(!v){if(Array.isArray(u)||(v=c(u))||b&&u&&typeof u.length=="number"){v&&(u=v);var P=0,z=function(){};return{s:z,n:function(){return P>=u.length?{done:!0}:{done:!1,value:u[P++]}},e:function(T){throw T},f:z}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var R,W=!0,K=!1;return{s:function(){v=v.call(u)},n:function(){var T=v.next();return W=T.done,T},e:function(T){K=!0,R=T},f:function(){try{W||v.return==null||v.return()}finally{if(K)throw R}}}})(n.keys);try{for(h.s();!(o=h.n()).done;)f(o.value)}catch(u){h.e(u)}finally{h.f()}}else f()})),n.filter&&(s=n.filter(s));var a=s.slice(0,e.resultsList.maxResults);e.feedback={query:t,matches:s,results:a},g("results",e)},j="aria-expanded",B="aria-activedescendant",C="aria-selected",D=function(t,e){t.feedback.selection=_({index:e},t.feedback.results[e])},q=function(t){t.isOpen||((t.wrapper||t.input).setAttribute(j,!0),t.list.removeAttribute("hidden"),t.isOpen=!0,g("open",t))},H=function(t){t.isOpen&&((t.wrapper||t.input).setAttribute(j,!1),t.input.setAttribute(B,""),t.list.setAttribute("hidden",""),t.isOpen=!1,g("close",t))},U=function(t,e){var n=e.resultItem,i=e.list.getElementsByTagName(n.tag),s=!!n.selected&&n.selected.split(" ");if(e.isOpen&&i.length){var a,l,m=e.cursor;t>=i.length&&(t=0),t<0&&(t=i.length-1),e.cursor=t,m>-1&&(i[m].removeAttribute(C),s&&(l=i[m].classList).remove.apply(l,r(s))),i[t].setAttribute(C,!0),s&&(a=i[t].classList).add.apply(a,r(s)),e.input.setAttribute(B,i[e.cursor].id),e.list.scrollTop=i[t].offsetTop-e.list.clientHeight+i[t].clientHeight+5,e.feedback.cursor=e.cursor,D(e,t),g("navigate",e)}},V=function(t){U(t.cursor+1,t)},X=function(t){U(t.cursor-1,t)},N=function(t,e,n){(n=n>=0?n:t.cursor)<0||(t.feedback.event=e,D(t,n),g("selection",t),H(t))};function Y(t,e){var n=this;return new Promise((function(i,s){var a,l;return a=e||((l=t.input)instanceof HTMLInputElement||l instanceof HTMLTextAreaElement?l.value:l.innerHTML),(function(f,o,h){return o?o(f):f.length>=h})(a=t.query?t.query(a):a,t.trigger,t.threshold)?M(t,a).then((function(f){try{return t.feedback instanceof Error?i():(J(a,t),t.resultsList&&(function(o){var h=o.resultsList,u=o.list,b=o.resultItem,v=o.feedback,P=v.matches,z=v.results;if(o.cursor=-1,u.innerHTML="",P.length||h.noResults){var R=new DocumentFragment;z.forEach((function(W,K){var T=p(b.tag,_({id:"".concat(b.id,"_").concat(K),role:"option",innerHTML:W.match,inside:R},b.class&&{class:b.class}));b.element&&b.element(T,W)})),u.append(R),h.element&&h.element(u,v),q(o)}else H(o)})(t),m.call(n))}catch(o){return s(o)}}),s):(H(t),m.call(n));function m(){return i()}}))}var G=function(t,e){for(var n in t)for(var i in t[n])e(n,i)},et=function(t){var e,n,i,s=t.events,a=(e=function(){return Y(t)},n=t.debounce,function(){clearTimeout(i),i=setTimeout((function(){return e()}),n)}),l=t.events=_({input:_({},s&&s.input)},t.resultsList&&{list:s?_({},s.list):{}}),m={input:{input:function(){a()},keydown:function(f){(function(o,h){switch(o.keyCode){case 40:case 38:o.preventDefault(),o.keyCode===40?V(h):X(h);break;case 13:h.submit||o.preventDefault(),h.cursor>=0&&N(h,o);break;case 9:h.resultsList.tabSelect&&h.cursor>=0&&N(h,o);break;case 27:h.input.value="",H(h)}})(f,t)},blur:function(){H(t)}},list:{mousedown:function(f){f.preventDefault()},click:function(f){(function(o,h){var u=h.resultItem.tag.toUpperCase(),b=Array.from(h.list.querySelectorAll(u)),v=o.target.closest(u);v&&v.nodeName===u&&N(h,o,b.indexOf(v))})(f,t)}}};G(m,(function(f,o){(t.resultsList||o==="input")&&(l[f][o]||(l[f][o]=m[f][o]))})),G(l,(function(f,o){t[f].addEventListener(o,l[f][o])}))};function Z(t){var e=this;return new Promise((function(n,i){var s,a,l;if(s=t.placeHolder,l={role:"combobox","aria-owns":(a=t.resultsList).id,"aria-haspopup":!0,"aria-expanded":!1},p(t.input,_(_({"aria-controls":a.id,"aria-autocomplete":"both"},s&&{placeholder:s}),!t.wrapper&&_({},l))),t.wrapper&&(t.wrapper=p("div",_({around:t.input,class:t.name+"_wrapper"},l))),a&&(t.list=p(a.tag,_({dest:[a.destination,a.position],id:a.id,role:"listbox",hidden:"hidden"},a.class&&{class:a.class}))),et(t),t.data.cache)return M(t).then((function(f){try{return m.call(e)}catch(o){return i(o)}}),i);function m(){return g("init",t),n()}return m.call(e)}))}function nt(t){var e=t.prototype;e.init=function(){Z(this)},e.start=function(n){Y(this,n)},e.unInit=function(){if(this.wrapper){var n=this.wrapper.parentNode;n.insertBefore(this.input,this.wrapper),n.removeChild(this.wrapper)}var i;G((i=this).events,(function(s,a){i[s].removeEventListener(a,i.events[s][a])}))},e.open=function(){q(this)},e.close=function(){H(this)},e.goTo=function(n){U(n,this)},e.next=function(){V(this)},e.previous=function(){X(this)},e.select=function(n){N(this,null,n)},e.search=function(n,i,s){return O(n,i,s)}}return function t(e){this.options=e,this.id=t.instances=(t.instances||0)+1,this.name="autoComplete",this.wrapper=1,this.threshold=1,this.debounce=0,this.resultsList={position:"afterend",tag:"ul",maxResults:5},this.resultItem={tag:"li"},(function(n){var i=n.name,s=n.options,a=n.resultsList,l=n.resultItem;for(var m in s)if(x(s[m])==="object")for(var f in n[m]||(n[m]={}),s[m])n[m][f]=s[m][f];else n[m]=s[m];n.selector=n.selector||"#"+i,a.destination=a.destination||n.selector,a.id=a.id||i+"_list_"+n.id,l.id=l.id||i+"_result",n.input=d(n.selector)})(this),nt.call(this,t),Z(this)}},S.exports=E()})},Q={};function A(S){var w=Q[S];if(w!==void 0)return w.exports;var E=Q[S]={exports:{}};return tt[S].call(E.exports,E,E.exports,A),E.exports}(function(){A.n=function(S){var w=S&&S.__esModule?function(){return S.default}:function(){return S};return A.d(w,{a:w}),w}})(),(function(){A.d=function(S,w){for(var E in w)A.o(w,E)&&!A.o(S,E)&&Object.defineProperty(S,E,{enumerable:!0,get:w[E]})}})(),(function(){A.o=function(S,w){return Object.prototype.hasOwnProperty.call(S,w)}})(),(function(){"use strict";var S=A(55657),w=A.n(S),E=(I,r,c)=>new Promise((y,d)=>{var p=g=>{try{L(c.next(g))}catch(O){d(O)}},k=g=>{try{L(c.throw(g))}catch(O){d(O)}},L=g=>g.done?y(g.value):Promise.resolve(g.value).then(p,k);L((c=c.apply(I,r)).next())});class F{constructor(r,c={}){this.element=r,this.stickySelectedSpan=null,this.clearStickySelectionSpan=null,this.stickyHiddenInput=null,this.promptDiv=null;const y=c.threshold||2;this.options=Object.assign({name:null,placeholder:"",mode:null,searchPrompt:!1,searchPromptText:`Type at least ${y} characters to search`,selected:null,threshold:y,maxResults:10,dataMatchKeys:null,dataSource:()=>[],dataFilter:null,delay:200,modifyList:null,modifyResult:null},c),this.autocomplete=new(w())({selector:()=>this.element,diacritics:!0,placeHolder:c.placeholder,debounce:200,threshold:this.options.threshold,data:{keys:this.options.dataMatchKeys,src:p=>E(this,null,function*(){const k=()=>new Promise(L=>{this.options.dataSource(p,L)});try{return yield k()}catch(L){return L}}),filter:p=>{const k=p.filter((L,g,O)=>O.findIndex(M=>M.value===L.value)===g);return this.options.dataFilter?this.options.dataFilter(k):k}},resultsList:{maxResults:this.options.maxResults,element:(p,k)=>{this.options.modifyList&&this.options.modifyList(p,k)}},resultItem:{element:(p,k)=>{this.options.modifyResult&&this.options.modifyResult(p,k.value)}},events:{input:{blur:()=>{this.promptDiv.style.display="none"}}}}),this.acWrapper=this.element.closest(".autoComplete_wrapper"),this.element.ac=this.autocomplete;const d=p=>{p.stopPropagation()};switch(this.element.addEventListener("close",d),this.element.addEventListener("open",d),this.createPromptDiv(),this.options.mode){case"sticky":this.createStickySelect(this.options.name);break;case"multi":this.createMultiSelect(this.options.name);break;default:}}setInput(r){this.autocomplete.input.value=r}handleEvent(r){switch(this.options.mode){case"single":this.setInput(r.detail.selection.value[r.detail.selection.key]);break;case"sticky":this.handleStickyEvents(r);break;case"multi":this.handleMultiEvents(r);break;default:}}handleMultiEvents(r){switch(r.type){case"selection":this.addMultiSelectItem(r.detail.selection);break;default:}}handleStickyEvents(r){switch(r.type){case"selection":this.addStickySelectItem(r.detail.selection);break;case"click":r.target===this.clearStickySelectionSpan&&this.removeStickySelection();break;case"keyup":this.stickyHiddenInput.value!==""&&r.target===this.element&&(["Escape","Backspace","Delete"].includes(r.key)||/^[a-z0-9]$/i.test(r.key))?this.removeStickySelection():this.options.searchPrompt&&(this.stickyHiddenInput.value===""&&this.element.value.length<this.options.threshold?this.promptDiv.style.display="block":this.promptDiv.style.display="none");break;default:}}createHiddenInput(r){const c=document.createElement("input");return c.name=this.options.name,c.type="hidden",r&&(c.value=r),this.acWrapper.prepend(c),c}removeStickySelection(){this.stickyHiddenInput.value="",this.element.placeholder=this.options.placeholder,this.clearStickySelectionSpan.style.display="none",this.stickySelectedSpan.style.display="none"}addStickySelectItem(r){this.stickyHiddenInput.value=r.value.value,this.element.placeholder="",this.stickySelectedSpan.innerHTML=r.value[r.key],this.stickySelectedSpan.style.display="block",this.clearStickySelectionSpan.style.display="block",this.setInput("")}addMultiSelectItem(r){this.setInput("");const c=document.createElement("span");c.classList.add("label","primary","autocomplete__selected-item","multi"),c.innerHTML=r.value[r.key];const y=document.createElement("span");y.classList.add("clear-multi-selection"),y.innerHTML="&times;",y.setAttribute("data-remove",r.value.value),y.addEventListener("click",k=>{const L=this.acWrapper.querySelector(`input[type='hidden'][value='${r.value.value}']`);L&&(L.remove(),k.target.parentElement.remove())}),c.appendChild(y);const d=this.acWrapper.querySelector(".multiselect"),p=d.querySelector("span.input-container");d.insertBefore(c,p),this.createHiddenInput(r.value.value)}createStickySelect(){this.stickySelectedSpan=document.createElement("span"),this.stickySelectedSpan.classList.add("autocomplete__selected-item","sticky"),this.stickySelectedSpan.style.display="none",this.stickySelectedSpan.addEventListener("click",()=>this.element.focus()),this.stickyHiddenInput=this.createHiddenInput(),this.clearStickySelectionSpan=document.createElement("span"),this.clearStickySelectionSpan.className="clear-sticky-selection",this.clearStickySelectionSpan.innerHTML="&times;",this.clearStickySelectionSpan.style.display="none",this.clearStickySelectionSpan.addEventListener("click",this),this.element.addEventListener("selection",this),this.element.addEventListener("keyup",this),this.acWrapper.insertBefore(this.clearStickySelectionSpan,this.element),this.acWrapper.insertBefore(this.stickySelectedSpan,this.element),this.options.selected&&this.addStickySelectItem(this.options.selected)}createMultiSelect(){const r=document.createElement("div");r.classList.add("multiselect");const c=document.createElement("span");c.classList.add("input-container"),r.appendChild(c),this.acWrapper.prepend(r),c.appendChild(this.element),this.element.addEventListener("selection",this),r.addEventListener("click",()=>{this.element.focus()}),this.options.selected&&this.options.selected.forEach(y=>{this.addMultiSelectItem(y)})}createPromptDiv(){this.promptDiv=document.createElement("div"),this.promptDiv.classList.add("search-prompt"),this.promptDiv.style.display="none",this.promptDiv.innerHTML=this.options.searchPromptText,this.acWrapper.appendChild(this.promptDiv)}}$(()=>{$("[data-decidim-geocoding]").each((I,r)=>{const c=$(r),y=new F(r,{mode:"single",dataMatchKeys:["value"],dataSource:(d,p)=>{c.trigger("geocoder-suggest.decidim",[d,p])}});r.addEventListener("selection",y),c.on("selection",d=>{const p=d.detail.selection.value;c.trigger("geocoder-suggest-select.decidim",[p]),p.coordinates&&c.trigger("geocoder-suggest-coordinates.decidim",[p.coordinates])})})});const _=I=>I.filter(r=>r!==null&&typeof r!="undefined"&&`${r}`.trim().length>0);function x(I,r,c=", "){const y=r.map(d=>Array.isArray(d)?x(I,d," "):I[d]||I[d.toLowerCase()]);return _(y).join(c).trim()}$(()=>{const I=x;$("[data-decidim-geocoding]").each((r,c)=>{const y=$(c),d=y.data("decidim-geocoding"),p=d.queryMinLength||2,k=d.supportedLanguages||["de","en","it","fr"],L=d.defaultLanguage||"en",g=d.addressFormat||["name",["street","housenumber"],"postcode","city","state","country"];let O=$("html").attr("lang");k.includes(O)||(O=L);let M=null;!d.url||d.url.length<1||y.on("geocoder-suggest.decidim",(J,j,B)=>{clearTimeout(M),!(`${j}`.trim().length<p)&&(M=setTimeout(()=>{$.ajax({method:"GET",url:d.url,data:{q:j,lang:O},dataType:"json"}).done(C=>C.features?B(C.features.map(D=>{const q=I(D.properties,g);return{key:q,value:q,coordinates:D.geometry.coordinates.reverse()}})):null)},200))})})})})()})();

//# sourceMappingURL=decidim_geocoding_provider_photon-8c0a77854f2b22930bd5.js.map